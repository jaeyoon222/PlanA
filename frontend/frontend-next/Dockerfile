# 1λ‹¨κ³„: λΉλ“
FROM node:20-alpine AS builder

WORKDIR /app
COPY . .

# π”¥ λΉλ“ μ‹μ μ— ν•„μ”ν• ν™κ²½ λ³€μ μ£Όμ…
ARG NEXT_PUBLIC_API_BASE
ARG NEXT_PUBLIC_OAUTH_BASE
ARG NEXT_PUBLIC_KAKAO_KEY

ENV NEXT_PUBLIC_API_BASE=$NEXT_PUBLIC_API_BASE
ENV NEXT_PUBLIC_OAUTH_BASE=$NEXT_PUBLIC_OAUTH_BASE
ENV NEXT_PUBLIC_KAKAO_KEY=$NEXT_PUBLIC_KAKAO_KEY

RUN npm install
RUN npm run build

# 2λ‹¨κ³„: μ‹¤ν–‰
FROM node:20-alpine

WORKDIR /app
COPY --from=builder /app ./

EXPOSE 3000

# β… μ™Έλ¶€ μ ‘μ† ν—μ©
CMD ["npx", "next", "start", "-H", "0.0.0.0"]
